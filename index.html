<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dedicated Inference ‚Äî Metrics Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root{--bg:#08090d;--sf:#0f1117;--sf2:#161820;--sf3:#1c1e28;--bd:#252736;--tx:#e2e4ed;--td:#7a7f99;--tm:#4e5269;--ac:#3b82f6;--acd:rgba(59,130,246,0.12);--gn:#10b981;--gnd:rgba(16,185,129,0.12);--rd:#ef4444;--rdd:rgba(239,68,68,0.12);--or:#f59e0b;--ord:rgba(245,158,11,0.12);--cy:#06b6d4;--cyd:rgba(6,182,212,0.12);--pu:#8b5cf6;--pud:rgba(139,92,246,0.12)}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Outfit',sans-serif;background:var(--bg);color:var(--tx);min-height:100vh}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
@keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
.fade{animation:fadeUp .5s ease forwards}
::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:var(--bg)}::-webkit-scrollbar-thumb{background:var(--bd);border-radius:3px}
.mono{font-family:'IBM Plex Mono',monospace}

/* Header */
.header{background:var(--sf);border-bottom:1px solid var(--bd);padding:14px 28px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100}
.logo{width:32px;height:32px;border-radius:8px;background:linear-gradient(135deg,var(--ac),var(--cy));display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;color:#fff}
.header-left{display:flex;align-items:center;gap:14}
.header-right{display:flex;align-items:center;gap:8}
.live-badge{margin-left:12px;padding:6px 12px;border-radius:6px;background:var(--gnd);color:var(--gn);font-size:11px;font-weight:500;display:flex;align-items:center;gap:6}
.live-dot{width:6px;height:6px;border-radius:50%;background:var(--gn);animation:pulse 2s infinite}

/* Time tabs */
.time-btn{padding:7px 16px;border-radius:6px;border:none;cursor:pointer;font-size:12px;font-weight:500;background:transparent;color:var(--td);transition:all .2s}
.time-btn.active{background:var(--acd);color:var(--ac)}

/* Nav */
.nav{padding:12px 28px 0;display:flex;gap:4;border-bottom:1px solid var(--bd);background:var(--bg)}
.nav-btn{padding:10px 18px;border:none;cursor:pointer;font-size:13px;font-weight:500;background:transparent;color:var(--td);border-bottom:2px solid transparent;transition:all .2s;margin-bottom:-1px}
.nav-btn.active{color:var(--tx);border-bottom-color:var(--ac)}

/* Content */
.content{padding:24px 28px 60px;max-width:1400px;margin:0 auto}

/* KPI Grid */
.kpi-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-bottom:8px}
.kpi{background:var(--sf);border:1px solid var(--bd);border-radius:10px;padding:18px 20px;display:flex;flex-direction:column;gap:4px}
.kpi-label{font-size:11px;color:var(--td);letter-spacing:.5px}
.kpi-val{font-size:28px;font-weight:700;letter-spacing:-1px}
.kpi-change{font-size:11px}
.kpi-sub{font-size:11px;color:var(--tm);margin-top:2px}

/* Section title */
.sec-title{display:flex;align-items:center;gap:10px;margin:32px 0 16px}
.sec-title span:first-child{font-size:16px}
.sec-title span:nth-child(2){font-size:13px;font-weight:600;letter-spacing:.5px;text-transform:uppercase}
.sec-title .line{flex:1;height:1px;background:var(--bd)}

/* Chart card */
.chart-card{background:var(--sf);border:1px solid var(--bd);border-radius:12px;padding:20px;margin-bottom:16px}
.chart-header{display:flex;justify-content:space-between;margin-bottom:12px;font-size:13px}
.chart-header .peak{font-size:12px;color:var(--td)}
.chart-row{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px}

/* SVG Charts */
svg.chart{width:100%;display:block;overflow:visible}

/* Status dot */
.dot{display:inline-block;width:7px;height:7px;border-radius:50%;margin-right:6px;vertical-align:middle}
.dot.green{background:var(--gn);box-shadow:0 0 6px rgba(16,185,129,.4)}
.dot.orange{background:var(--or);box-shadow:0 0 6px rgba(245,158,11,.4)}
.dot.muted{background:var(--tm)}
.dot.red{background:var(--rd);box-shadow:0 0 6px rgba(239,68,68,.4)}

/* GPU Bar */
.gpu-bar-bg{width:100%;height:5px;background:var(--sf3);border-radius:3px;overflow:hidden}
.gpu-bar-fill{height:100%;border-radius:3px;transition:width .5s ease}

/* Table */
table{width:100%;border-collapse:collapse;font-size:13px}
th{padding:12px 14px;text-align:left;font-size:10px;letter-spacing:1px;color:var(--tm);text-transform:uppercase;font-weight:500;border-bottom:1px solid var(--bd)}
td{padding:14px;border-bottom:1px solid var(--bd)}
tr:nth-child(even){background:var(--sf)}

/* GPU Heatmap */
.heatmap{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;background:var(--sf);border:1px solid var(--bd);border-radius:12px;padding:24px}
.heat-card{background:var(--sf2);border-radius:10px;padding:16px;border:1px solid var(--bd)}
.heat-val{font-size:32px;font-weight:700;letter-spacing:-1px;line-height:1}

/* Model cards */
.model-card{background:var(--sf);border:1px solid var(--bd);border-radius:12px;padding:20px 24px;display:grid;grid-template-columns:240px repeat(5,1fr) auto;align-items:center;gap:16px;margin-bottom:12px}
.model-metric{text-align:center}
.model-metric .val{font-size:18px;font-weight:700}
.model-metric .lbl{font-size:10px;color:var(--tm)}

/* Cost pie */
.cost-row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.cost-card{background:var(--sf);border:1px solid var(--bd);border-radius:12px;padding:24px}
.pie-wrap{display:flex;align-items:center;gap:24px}
.pie-legend{flex:1}
.pie-item{display:flex;align-items:center;gap:8px;padding:6px 0;font-size:13px}
.pie-dot{width:10px;height:10px;border-radius:3px;flex-shrink:0}

/* Recommendations */
.rec{background:var(--sf);border:1px solid var(--bd);border-radius:10px;padding:16px 20px;display:flex;justify-content:space-between;align-items:center;gap:16px;margin-bottom:10px}
.rec-save{padding:6px 14px;border-radius:6px;white-space:nowrap;background:var(--gnd);color:var(--gn);font-size:13px;font-weight:600}

/* Legend */
.legend{display:flex;gap:16px;justify-content:center;margin-top:4px}
.legend-item{display:flex;align-items:center;gap:5px;font-size:11px;color:var(--td)}
.legend-line{width:10px;height:2px;border-radius:1px}

/* SLA badge */
.sla-badge{font-size:10px;padding:3px 8px;border-radius:4px;background:var(--gnd);color:var(--gn)}

/* Detail button */
.detail-btn{padding:8px 16px;border-radius:6px;border:1px solid var(--bd);background:var(--sf2);color:var(--td);font-size:11px;cursor:pointer;transition:all .15s}.detail-btn:hover{border-color:var(--ac);color:var(--ac)}
.detail-panel{background:var(--sf);border:1px solid var(--bd);border-radius:12px;padding:24px;margin-bottom:20px;animation:fadeIn .2s}
.detail-back{display:inline-flex;align-items:center;gap:6px;padding:6px 14px;border-radius:6px;border:1px solid var(--bd);background:var(--sf2);color:var(--td);font-size:12px;cursor:pointer;margin-bottom:20px}.detail-back:hover{border-color:var(--ac);color:var(--ac)}
.detail-header{display:flex;align-items:center;gap:16px;margin-bottom:24px;flex-wrap:wrap}
.detail-header h2{font-size:20px;font-weight:700;margin:0}
.detail-badge{font-size:10px;padding:3px 8px;border-radius:4px;font-family:"IBM Plex Mono",monospace}
.replica-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px;margin-bottom:20px}
.replica-card{background:var(--sf2);border:1px solid var(--bd);border-radius:10px;padding:16px}
.replica-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;font-size:12px}
.replica-row .label{color:var(--tm)}.replica-row .value{color:var(--fg);font-family:"IBM Plex Mono",monospace}
.detail-charts{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:20px}
@media(max-width:768px){.detail-charts{grid-template-columns:1fr}}

/* Tag */
.gpu-tag{padding:3px 8px;border-radius:4px;font-size:11px}

/* Tab panels */
.tab-panel{display:none}.tab-panel.active{display:block}

@media(max-width:900px){
.chart-row,.cost-row{grid-template-columns:1fr}
.heatmap{grid-template-columns:repeat(2,1fr)}
.model-card{grid-template-columns:1fr;text-align:center}
.kpi-grid{grid-template-columns:repeat(2,1fr)}
}
</style>
</head>
<body>

<!-- Header -->
<div class="header">
  <div class="header-left">
    <div class="logo">DI</div>
    <div>
      <div style="font-size:15px;font-weight:600;letter-spacing:-.3px">Dedicated Inference</div>
      <div class="mono" style="font-size:11px;color:var(--td)">prod-cluster-us-east-1 ¬∑ <span class="dot green"></span><span style="color:var(--gn)">All systems operational</span></div>
    </div>
  </div>
  <div class="header-right">
    <button class="time-btn mono active" data-range="1h">1h</button>
    <button class="time-btn mono" data-range="6h">6h</button>
    <button class="time-btn mono" data-range="24h">24h</button>
    <button class="time-btn mono" data-range="3d">3d</button>
    <div class="live-badge mono"><span class="live-dot"></span>LIVE</div>
  </div>
</div>

<!-- Nav -->
<div class="nav">
  <button class="nav-btn active" data-tab="overview">Overview</button>
  <button class="nav-btn" data-tab="models">Model Deployments</button>
  <button class="nav-btn" data-tab="gpu">GPU Fleet</button>
  <button class="nav-btn" data-tab="costs">Cost & Billing</button>
</div>

<!-- Content -->
<div class="content">

  <!-- KPIs -->
  <div class="kpi-grid" id="kpis"></div>

  <!-- Overview -->
  <div class="tab-panel active" id="panel-overview">
    <div class="sec-title"><span>üìà</span><span class="mono">Throughput</span><div class="line"></div></div>
    <div class="chart-card fade">
      <div class="chart-header"><span style="font-weight:500">Requests per Second</span><span class="peak mono">Peak: 4,812 RPS</span></div>
      <svg class="chart" id="chart-rps" viewBox="0 0 800 180"></svg>
    </div>
    <div class="chart-row">
      <div class="chart-card fade">
        <div style="font-size:13px;font-weight:500;margin-bottom:4px">Latency Distribution (All Endpoints)</div>
        <div style="font-size:10px;color:var(--td);margin-bottom:10px">Per-endpoint P95 vs SLA in Model Deployments tab</div>
        <svg class="chart" id="chart-latency" viewBox="0 0 400 170"></svg>
        <div class="legend">
          <div class="legend-item"><span class="legend-line" style="background:var(--gn)"></span>p50</div>
          <div class="legend-item"><span class="legend-line" style="background:var(--or)"></span>p95</div>
          <div class="legend-item"><span class="legend-line" style="background:var(--rd)"></span>p99</div>
        </div>
      </div>
      <div class="chart-card fade">
        <div style="font-size:13px;font-weight:500;margin-bottom:12px">GPU Utilization (Cluster Avg)</div>
        <svg class="chart" id="chart-gpu" viewBox="0 0 400 170"></svg>
      </div>
    </div>
    <div class="chart-row">
      <div class="chart-card fade">
        <div class="chart-header"><span style="font-weight:500">Error Rate</span><span class="sla-badge mono">WITHIN SLA</span></div>
        <svg class="chart" id="chart-error" viewBox="0 0 400 140"></svg>
      </div>
      <div class="chart-card fade">
        <div style="font-size:13px;font-weight:500;margin-bottom:12px">KV Cache Utilization</div>
        <svg class="chart" id="chart-kv" viewBox="0 0 400 140"></svg>
      </div>
    </div>
  </div>

  <!-- Models -->
  <div class="tab-panel" id="panel-models">
    <div class="sec-title"><span>ü§ñ</span><span class="mono">Active Model Deployments</span><div class="line"></div></div>
    <div id="model-cards"></div>
    <div id="model-detail" style="display:none"></div>
    <div id="bench-section">
    <div class="sec-title"><span>‚ö°</span><span class="mono">Inference Performance Benchmarks</span><div class="line"></div></div>
    <div class="chart-card"><table id="bench-table"></table></div>
    </div>
  </div>

  <!-- GPU Fleet -->
  <div class="tab-panel" id="panel-gpu">
    <div class="sec-title"><span>üñ•Ô∏è</span><span class="mono">GPU Fleet Status</span><div class="line"></div></div>
    <div style="overflow-x:auto"><table id="gpu-table"></table></div>
    <div class="sec-title"><span>üìä</span><span class="mono">GPU Utilization Heatmap</span><div class="line"></div></div>
    <div class="heatmap" id="gpu-heatmap"></div>
  </div>

  <!-- Costs -->
  <div class="tab-panel" id="panel-costs">
    <div class="sec-title"><span>üí∞</span><span class="mono">Cost Breakdown</span><div class="line"></div></div>
    <div class="cost-row" style="margin-bottom:16px">
      <div class="cost-card">
        <div style="font-size:13px;font-weight:500;margin-bottom:16px">Cost per Hour (Trend)</div>
        <svg class="chart" id="chart-cost" viewBox="0 0 400 180"></svg>
      </div>
      <div class="cost-card">
        <div style="font-size:13px;font-weight:500;margin-bottom:16px">Cost Distribution</div>
        <div class="pie-wrap">
          <svg viewBox="0 0 200 200" width="180" height="180" id="pie-chart"></svg>
          <div class="pie-legend" id="pie-legend"></div>
        </div>
      </div>
    </div>
    <div class="sec-title"><span>üìä</span><span class="mono">Cost Efficiency Metrics</span><div class="line"></div></div>
    <div class="kpi-grid" id="cost-kpis"></div>
    <div class="sec-title"><span>üí°</span><span class="mono">Optimization Recommendations</span><div class="line"></div></div>
    <div id="recs"></div>
  </div>

</div>

<script>
// ===== DATA =====
var GPUS=[
{id:"gpu-a100-01",type:"A100-80GB",util:87,mem:71,temp:68,st:"active",model:"Llama-3.1-70B",vram:"57/80 GB",pw:"287W"},
{id:"gpu-a100-02",type:"A100-80GB",util:93,mem:82,temp:72,st:"active",model:"Llama-3.1-70B",vram:"66/80 GB",pw:"312W"},
{id:"gpu-a100-03",type:"A100-80GB",util:45,mem:68,temp:61,st:"active",model:"Mistral-7B-v0.3",vram:"14/80 GB",pw:"198W"},
{id:"gpu-a100-04",type:"A100-80GB",util:78,mem:75,temp:66,st:"active",model:"Llama-3.1-70B",vram:"60/80 GB",pw:"275W"},
{id:"gpu-h100-01",type:"H100-80GB",util:91,mem:88,temp:70,st:"active",model:"Mixtral-8x22B",vram:"71/80 GB",pw:"445W"},
{id:"gpu-h100-02",type:"H100-80GB",util:62,mem:55,temp:58,st:"active",model:"CodeLlama-34B",vram:"44/80 GB",pw:"342W"},
{id:"gpu-h100-03",type:"H100-80GB",util:0,mem:2,temp:34,st:"idle",model:"\u2014",vram:"2/80 GB",pw:"72W"},
{id:"gpu-a100-05",type:"A100-80GB",util:3,mem:5,temp:38,st:"draining",model:"\u2014",vram:"4/80 GB",pw:"85W"}
];
var MODELS=[
{name:"Llama-3.1-70B",rep:3,rps:1842,ttft:"52ms",tps:"78 t/s",up:"99.99%",cost:"$8.64/hr",st:"healthy",p95:118,sla:200,gpuType:"A100-80GB",gpuVendor:"NVIDIA"},
{name:"Mixtral-8x22B",rep:1,rps:624,ttft:"68ms",tps:"45 t/s",up:"99.98%",cost:"$4.12/hr",st:"healthy",p95:156,sla:250,gpuType:"H100-80GB",gpuVendor:"NVIDIA"},
{name:"Mistral-7B-v0.3",rep:1,rps:2105,ttft:"18ms",tps:"142 t/s",up:"100%",cost:"$2.88/hr",st:"healthy",p95:42,sla:100,gpuType:"A100-80GB",gpuVendor:"NVIDIA"},
{name:"CodeLlama-34B",rep:1,rps:388,ttft:"41ms",tps:"92 t/s",up:"99.97%",cost:"$4.12/hr",st:"scaling",p95:98,sla:150,gpuType:"H100-80GB",gpuVendor:"NVIDIA"}
];
var COSTS=[{n:"GPU Compute",v:68,c:"#3b82f6"},{n:"Networking",v:12,c:"#06b6d4"},{n:"Storage",v:8,c:"#8b5cf6"},{n:"CPU/RAM",v:7,c:"#f59e0b"},{n:"Egress",v:5,c:"#10b981"}];
var BENCHMARKS=[
["Llama-3.1-70B","32","2048","512","52ms","78 t/s","12.8ms","57 GB"],
["Llama-3.1-70B","1","512","256","28ms","112 t/s","8.9ms","54 GB"],
["Mixtral-8x22B","16","4096","1024","68ms","45 t/s","22.2ms","71 GB"],
["Mistral-7B-v0.3","64","2048","512","18ms","142 t/s","7.0ms","14 GB"],
["CodeLlama-34B","8","8192","2048","41ms","92 t/s","10.8ms","44 GB"]
];
var RECS=[
{sev:"high",save:"$840/mo",desc:"gpu-h100-03 has been idle for 6+ hours. Consider scale-to-zero policy or reassigning to a queued workload.",c:"#ef4444"},
{sev:"medium",save:"$320/mo",desc:"Mistral-7B-v0.3 is running on A100-80GB but only using 14GB VRAM. Downgrade to A10G for 65% cost reduction.",c:"#f59e0b"},
{sev:"low",save:"$120/mo",desc:"Enable INT8 quantization for CodeLlama-34B batch inference. Est. 15% throughput increase with minimal quality impact.",c:"#10b981"}
];

// ===== HELPERS =====
function genData(n,base,v){var d=[];for(var i=0;i<n;i++){d.push(base+(Math.random()-.5)*v+(Math.random()>.92?v:0))}return d}
function dotClass(s){return s==="active"||s==="healthy"?"green":s==="scaling"||s==="draining"?"orange":s==="idle"?"muted":"red"}
function barColor(v){return v>85?"var(--rd)":v>60?"var(--cy)":"var(--tm)"}

var AX={pl:40,pt:5,pb:22,pr:5};
function makePath(data,cw,ch,maxV,minV){
  if(!maxV)maxV=Math.max.apply(null,data)*1.1;
  if(minV===undefined)minV=Math.min.apply(null,data)*.9;
  var pts=[];
  for(var i=0;i<data.length;i++){
    var x=AX.pl+(i/(data.length-1))*cw;
    var y=AX.pt+ch-((data[i]-minV)/(maxV-minV))*ch;
    pts.push(x.toFixed(1)+","+y.toFixed(1));
  }
  return pts.join(" ");
}
function axisHTML(cw,ch,maxV,minV,unit,nTicks){
  if(!nTicks)nTicks=4;
  var html='';
  // Gridlines and Y labels
  for(var i=0;i<=nTicks;i++){
    var frac=i/nTicks;
    var y=AX.pt+ch-frac*ch;
    var val=minV+frac*(maxV-minV);
    var label;
    if(unit==='%'){label=val<1?val.toFixed(2)+'%':Math.round(val)+'%';}
    else if(unit==='ms')label=Math.round(val)+'ms';
    else if(unit==='rps')label=val>=1000?Math.round(val/100)/10+'k':Math.round(val);
    else if(unit==='$/hr')label='$'+Math.round(val);
    else if(unit==='t/s')label=Math.round(val);
    else label=val>=1000?(val/1000).toFixed(1)+'k':val>=10?Math.round(val):val.toFixed(2);
    html+='<line x1="'+AX.pl+'" y1="'+y.toFixed(1)+'" x2="'+(AX.pl+cw).toFixed(1)+'" y2="'+y.toFixed(1)+'" stroke="rgba(255,255,255,0.12)" stroke-width="1"/>';
    html+='<text x="'+(AX.pl-6)+'" y="'+(y+3).toFixed(1)+'" fill="rgba(255,255,255,0.5)" font-size="10" font-family="IBM Plex Mono,monospace" text-anchor="end">'+label+'</text>';
  }
  // X-axis time labels
  var times=["24h","20h","16h","12h","8h","4h","now"];
  for(var j=0;j<times.length;j++){
    var x=AX.pl+(j/(times.length-1))*cw;
    html+='<text x="'+x.toFixed(1)+'" y="'+(AX.pt+ch+16)+'" fill="rgba(255,255,255,0.45)" font-size="9" font-family="IBM Plex Mono,monospace" text-anchor="middle">'+times[j]+'</text>';
  }
  // Y-axis unit label
  html+='<text x="4" y="'+(AX.pt+ch/2)+'" fill="rgba(255,255,255,0.4)" font-size="9" font-family="IBM Plex Mono,monospace" transform="rotate(-90,4,'+(AX.pt+ch/2)+')">'+unit+'</text>';
  return html;
}

function makeArea(svgId,data,w,h,stroke,fillId,maxV,minV,unit){
  var svg=document.getElementById(svgId);
  if(!svg)return;
  var cw=w-AX.pl-AX.pr;
  var ch=h-AX.pt-AX.pb;
  if(!maxV)maxV=Math.max.apply(null,data)*1.1;
  if(minV===undefined)minV=Math.min.apply(null,data)*.9;
  var pts=makePath(data,cw,ch,maxV,minV);
  var first=AX.pl+","+( AX.pt+ch);
  var last=(AX.pl+cw)+","+(AX.pt+ch);
  var axes=unit?axisHTML(cw,ch,maxV,minV,unit):'';
  svg.innerHTML='<defs><linearGradient id="'+fillId+'" x1="0" y1="0" x2="0" y2="1">'+
    '<stop offset="0%" stop-color="'+stroke+'" stop-opacity="0.25"/>'+
    '<stop offset="100%" stop-color="'+stroke+'" stop-opacity="0"/></linearGradient></defs>'+
    '<polygon points="'+first+" "+pts+" "+last+'" fill="url(#'+fillId+')" />'+
    '<polyline points="'+pts+'" fill="none" stroke="'+stroke+'" stroke-width="2" stroke-linejoin="round"/>'+axes;
}

function makeMultiLine(svgId,datasets,w,h,unit){
  var svg=document.getElementById(svgId);if(!svg)return;
  var cw=w-AX.pl-AX.pr;
  var ch=h-AX.pt-AX.pb;
  var allVals=[];datasets.forEach(function(d){allVals=allVals.concat(d.data)});
  var maxV=Math.max.apply(null,allVals)*1.15;
  var minV=Math.min.apply(null,allVals)*.85;
  var axes=unit?axisHTML(cw,ch,maxV,minV,unit):'';
  var html='';
  datasets.forEach(function(ds){
    var pts=makePath(ds.data,cw,ch,maxV,minV);
    html+='<polyline points="'+pts+'" fill="none" stroke="'+ds.color+'" stroke-width="2" stroke-linejoin="round"/>';
  });
  svg.innerHTML=html+axes;
}

function makePie(svgId,data){
  var svg=document.getElementById(svgId);if(!svg)return;
  var total=data.reduce(function(s,d){return s+d.v},0);
  var cx=100,cy=100,r=70,ir=45;
  var angle=-90;var html='';
  data.forEach(function(d){
    var a1=angle*Math.PI/180;
    var sweep=d.v/total*360;
    var a2=(angle+sweep)*Math.PI/180;
    var lg=sweep>180?1:0;
    var x1=cx+r*Math.cos(a1),y1=cy+r*Math.sin(a1);
    var x2=cx+r*Math.cos(a2),y2=cy+r*Math.sin(a2);
    var ix1=cx+ir*Math.cos(a1),iy1=cy+ir*Math.sin(a1);
    var ix2=cx+ir*Math.cos(a2),iy2=cy+ir*Math.sin(a2);
    html+='<path d="M'+ix1+' '+iy1+' L'+x1+' '+y1+' A'+r+' '+r+' 0 '+lg+' 1 '+x2+' '+y2+' L'+ix2+' '+iy2+' A'+ir+' '+ir+' 0 '+lg+' 0 '+ix1+' '+iy1+'" fill="'+d.c+'"/>';
    angle+=sweep;
  });
  svg.innerHTML=html;
}

// ===== RENDER =====
var totalRPS=MODELS.reduce(function(s,m){return s+m.rps},0);
var actGPU=GPUS.filter(function(g){return g.st==="active"}).length;
var avgU=Math.round(GPUS.filter(function(g){return g.st==="active"}).reduce(function(s,g){return s+g.util},0)/actGPU);

// KPIs
var kpis=[
{l:"TOTAL RPS",v:totalRPS.toLocaleString(),ch:"+12.3% vs yesterday",dir:"up",c:"var(--ac)"},
{l:"SLA COMPLIANCE",v:"4/4",u:"endpoints",ch:"All within latency target",dir:"up",c:"var(--gn)"},
{l:"GPU UTILIZATION",v:avgU+"%",ch:"Across 6 active GPUs",c:avgU>80?"var(--or)":"var(--gn)"},
{l:"ACTIVE GPUS",v:actGPU+"/"+GPUS.length,sub:"1 idle \u00B7 1 draining",c:"var(--cy)"},
{l:"TOKENS / SEC",v:"142K",ch:"+18K vs yesterday",dir:"up",c:"var(--pu)"},
{l:"ERROR RATE",v:"0.04",u:"%",ch:"Below 0.1% SLA",dir:"up",c:"var(--gn)"},
{l:"HOURLY COST",v:"$19.76",ch:"+$1.20 (scaling event)",dir:"down",c:"var(--or)"},
{l:"UPTIME (30d)",v:"99.99",u:"%",sub:"2m 37s downtime total",c:"var(--gn)"}
];
function renderKPIs(id,items){
  var el=document.getElementById(id);
  el.innerHTML=items.map(function(k){
    var arrow=k.dir==="up"?"\u25B2":k.dir==="down"?"\u25BC":"\u2013";
    var chColor=k.dir==="up"?"var(--gn)":k.dir==="down"?"var(--rd)":"var(--td)";
    return '<div class="kpi">'+
      '<div class="kpi-label mono">'+k.l+'</div>'+
      '<div style="display:flex;align-items:baseline;gap:6px"><span class="kpi-val" style="color:'+k.c+'">'+k.v+'</span>'+(k.u?'<span style="font-size:13px;color:var(--td)">'+k.u+'</span>':'')+'</div>'+
      (k.ch?'<div class="kpi-change mono" style="color:'+chColor+'">'+arrow+' '+k.ch+'</div>':'')+
      (k.sub?'<div class="kpi-sub">'+k.sub+'</div>':'')+
    '</div>';
  }).join('');
}
renderKPIs("kpis",kpis);

// Charts data
var rpsData=genData(48,2400,800);
var gpuData=genData(48,76,20);
var errData=genData(48,.12,.1);
var kvData=genData(48,62,25);
var costDataArr=genData(48,19.76,5);
var latP50=genData(48,50,12);
var latP95=genData(48,115,25);
var latP99=genData(48,185,50);

makeArea("chart-rps",rpsData,800,180,"#3b82f6","rpsF",undefined,undefined,"rps");
makeMultiLine("chart-latency",[{data:latP50,color:"#10b981"},{data:latP95,color:"#f59e0b"},{data:latP99,color:"#ef4444"}],400,170,"ms");
makeArea("chart-gpu",gpuData,400,170,"#06b6d4","gpuF",100,0,"%");
makeArea("chart-error",errData,400,140,"#ef4444","errF",undefined,undefined,"%");
makeArea("chart-kv",kvData,400,140,"#8b5cf6","kvF",100,0,"%");
makeArea("chart-cost",costDataArr,400,180,"#f59e0b","costF",undefined,undefined,"$/hr");
makePie("pie-chart",COSTS);

// Pie legend
document.getElementById("pie-legend").innerHTML=COSTS.map(function(c){
  return '<div class="pie-item"><span class="pie-dot" style="background:'+c.c+'"></span><span style="flex:1;color:var(--td)">'+c.n+'</span><span class="mono" style="font-size:12px;font-weight:500">'+c.v+'%</span></div>';
}).join('');

// GPU table
document.getElementById("gpu-table").innerHTML=
  '<thead><tr>'+["Node","GPU Type","Status","Model","Utilization","Memory","VRAM","Temp","Power"].map(function(h){return '<th class="mono">'+h+'</th>'}).join('')+'</tr></thead>'+
  '<tbody>'+GPUS.map(function(g){
    var tagBg=g.type.indexOf("H100")>-1?"var(--pud)":"var(--cyd)";
    var tagC=g.type.indexOf("H100")>-1?"var(--pu)":"var(--cy)";
    return '<tr>'+
      '<td class="mono" style="font-size:12px;color:var(--ac)">'+g.id+'</td>'+
      '<td><span class="gpu-tag mono" style="background:'+tagBg+';color:'+tagC+'">'+g.type+'</span></td>'+
      '<td><span class="dot '+dotClass(g.st)+'"></span><span style="font-size:12px">'+g.st+'</span></td>'+
      '<td style="font-weight:500;font-size:12px">'+g.model+'</td>'+
      '<td style="width:140px"><div style="display:flex;align-items:center;gap:8px"><div class="gpu-bar-bg"><div class="gpu-bar-fill" style="width:'+g.util+'%;background:'+barColor(g.util)+'"></div></div><span class="mono" style="font-size:11px;color:var(--td);min-width:32px">'+g.util+'%</span></div></td>'+
      '<td style="width:140px"><div style="display:flex;align-items:center;gap:8px"><div class="gpu-bar-bg"><div class="gpu-bar-fill" style="width:'+g.mem+'%;background:var(--pu)"></div></div><span class="mono" style="font-size:11px;color:var(--td);min-width:32px">'+g.mem+'%</span></div></td>'+
      '<td class="mono" style="font-size:11px;color:var(--td)">'+g.vram+'</td>'+
      '<td class="mono" style="font-size:11px;color:'+(g.temp>70?"var(--or)":"var(--td)")+'">'+g.temp+'\u00B0C</td>'+
      '<td class="mono" style="font-size:11px;color:var(--td)">'+g.pw+'</td></tr>';
  }).join('')+'</tbody>';

// GPU heatmap
document.getElementById("gpu-heatmap").innerHTML=GPUS.map(function(g){
  var vc=g.util>85?"var(--rd)":g.util>60?"var(--cy)":"var(--tm)";
  var bc=g.util>85?"rgba(239,68,68,.25)":g.util>60?"rgba(6,182,212,.2)":"var(--bd)";
  return '<div class="heat-card" style="border-color:'+bc+'">'+
    '<div style="display:flex;justify-content:space-between;margin-bottom:10px"><span class="mono" style="font-size:11px;color:var(--td)">'+g.id+'</span><span class="dot '+dotClass(g.st)+'"></span></div>'+
    '<div class="heat-val" style="color:'+vc+'">'+g.util+'%</div>'+
    '<div style="font-size:10px;color:var(--tm);margin:6px 0">'+g.type+' \u00B7 '+g.temp+'\u00B0C</div>'+
    '<div class="gpu-bar-bg"><div class="gpu-bar-fill" style="width:'+g.util+'%;background:'+barColor(g.util)+'"></div></div></div>';
}).join('');

// Model cards
var mc=document.getElementById("model-cards");
mc.innerHTML=MODELS.map(function(m,idx){
  var pct=Math.round(m.p95/m.sla*100);var slaOk=m.p95<m.sla;
  var slaHtml='<div class="model-metric"><div class="val" style="color:'+(slaOk?'var(--gn)':'var(--rd)')+'">'+m.p95+'<span style="font-size:12px;font-weight:400;color:var(--td)">/'+m.sla+'ms</span></div><div style="margin-top:4px"><div class="gpu-bar-bg" style="height:4px"><div class="gpu-bar-fill" style="width:'+pct+'%;background:'+(pct>90?'var(--or)':slaOk?'var(--gn)':'var(--rd)')+'"></div></div></div><div class="lbl">P95 vs SLA</div></div>';
  var metrics=[{v:m.rps.toLocaleString(),l:"RPS",c:"var(--ac)"},{v:m.ttft,l:"TTFT",c:"var(--gn)"},{v:m.tps,l:"Throughput",c:"var(--pu)"},{v:m.up,l:"Uptime",c:"var(--gn)"},{v:m.cost,l:"Cost",c:"var(--or)"}];
  return '<div class="model-card" style="grid-template-columns:220px 1fr repeat(5,1fr) auto">'+
    '<div><div style="font-weight:600;font-size:15px">'+m.name+'</div><div style="font-size:11px;color:var(--td);margin-top:4px">'+m.rep+' replica'+(m.rep>1?'s':'')+' \u00B7 <span class="dot '+dotClass(m.st)+'"></span>'+m.st+'</div>'+
    '<div style="margin-top:6px"><span class="mono" style="font-size:10px;padding:2px 6px;border-radius:4px;background:rgba(255,255,255,0.06);color:var(--cy)">'+m.rep+'\u00D7 '+m.gpuType+'</span></div></div>'+
    slaHtml+
    metrics.map(function(d){return '<div class="model-metric"><div class="val" style="color:'+d.c+'">'+d.v+'</div><div class="lbl">'+d.l+'</div></div>'}).join('')+
    '<button class="detail-btn mono" data-idx="'+idx+'">Details \u2192</button></div>';
}).join('');

// Benchmarks table
document.getElementById("bench-table").innerHTML=
  '<thead><tr>'+["Model","Batch","Input Tok","Output Tok","TTFT","TPS","ITL","GPU Mem"].map(function(h){return '<th class="mono">'+h+'</th>'}).join('')+'</tr></thead>'+
  '<tbody>'+BENCHMARKS.map(function(r){return '<tr>'+r.map(function(c,j){return '<td '+(j>0?'class="mono" style="font-size:12px;color:var(--td)"':'style="font-weight:500"')+'>'+c+'</td>'}).join('')+'</tr>'}).join('')+'</tbody>';

// Cost KPIs
renderKPIs("cost-kpis",[
  {l:"COST / 1M TOKENS",v:"$0.42",ch:"-$0.08 vs last week",dir:"up",c:"var(--gn)"},
  {l:"COST / 1K REQUESTS",v:"$0.87",ch:"-12% optimized",dir:"up",c:"var(--gn)"},
  {l:"GPU IDLE WASTE",v:"$2.14",u:"/hr",ch:"11% of total spend",dir:"down",c:"var(--rd)"},
  {l:"MONTHLY PROJECTED",v:"$14,227",ch:"Based on current usage",c:"var(--ac)"}
]);

// Recommendations
document.getElementById("recs").innerHTML=RECS.map(function(r){
  return '<div class="rec" style="border-left:3px solid '+r.c+'">'+
    '<div><span class="mono" style="font-size:10px;letter-spacing:1px;text-transform:uppercase;font-weight:600;color:'+r.c+'">'+r.sev+' priority</span>'+
    '<div style="font-size:13px;color:var(--td);margin-top:6px;line-height:1.5">'+r.desc+'</div></div>'+
    '<div class="rec-save mono">Save '+r.save+'</div></div>';
}).join('');

// ===== TAB SWITCHING =====
document.querySelectorAll('.nav-btn').forEach(function(btn){
  btn.addEventListener('click',function(){
    document.querySelectorAll('.nav-btn').forEach(function(b){b.classList.remove('active')});
    document.querySelectorAll('.tab-panel').forEach(function(p){p.classList.remove('active')});
    btn.classList.add('active');
    document.getElementById('panel-'+btn.dataset.tab).classList.add('active');
    // Reset detail view when switching tabs
    var dp=document.getElementById('model-detail');
    dp.style.display='none';
    document.getElementById('model-cards').style.display='';
    // shown via bench-section
    document.getElementById('bench-section').style.display='';
  });
});

// ===== ENDPOINT DETAIL DRILL-DOWN =====
function showModelDetail(idx){
  var m=MODELS[idx];
  var dp=document.getElementById('model-detail');
  var gpus=GPUS.filter(function(g){return g.model===m.name});

  // Hide cards, show detail
  document.getElementById('model-cards').style.display='none';
  // hidden via bench-section
  document.getElementById('bench-section').style.display='none';
  dp.style.display='block';

  // Status color
  var stColor=m.st==='healthy'?'var(--gn)':m.st==='scaling'?'var(--or)':'var(--rd)';

  // Autoscaling config (simulated)
  var autoScale={min:m.rep,max:m.rep*3,target:'70% GPU utilization',cooldown:'5m',policy:m.rep>1?'Active':'Manual'};

  var html='<button class="detail-back mono" onclick="hideModelDetail()">\u2190 All Endpoints</button>';

  // Header
  html+='<div class="detail-header">'+
    '<h2>'+m.name+'</h2>'+
    '<span class="detail-badge" style="background:rgba(6,182,212,0.15);color:var(--cy)">'+m.rep+'\u00D7 '+m.gpuType+'</span>'+
    '<span class="detail-badge" style="background:rgba(6,182,212,0.08);color:var(--tm)">'+m.gpuVendor+'</span>'+
    '<span class="detail-badge" style="background:'+(m.st==='healthy'?'rgba(16,185,129,0.15)':'rgba(245,158,11,0.15)')+';color:'+stColor+'"><span class="dot '+dotClass(m.st)+'" style="margin-right:4px"></span>'+m.st+'</span>'+
  '</div>';

  // Endpoint-level KPIs
  var pct=Math.round(m.p95/m.sla*100);
  html+='<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:12px;margin-bottom:24px">';
  [{l:'P95 Latency',v:m.p95+'ms',sub:'/'+m.sla+'ms SLA ('+pct+'%)',c:pct>90?'var(--or)':'var(--gn)'},
   {l:'RPS',v:m.rps.toLocaleString(),sub:'requests/sec',c:'var(--ac)'},
   {l:'TTFT',v:m.ttft,sub:'time to first token',c:'var(--gn)'},
   {l:'Throughput',v:m.tps,sub:'tokens/sec',c:'var(--pu)'},
   {l:'Uptime',v:m.up,sub:'last 30 days',c:'var(--gn)'},
   {l:'Cost',v:m.cost,sub:'$'+(parseFloat(m.cost.replace('$','').replace('/hr',''))*730).toFixed(0)+'/mo projected',c:'var(--or)'}
  ].forEach(function(k){
    html+='<div style="background:var(--sf2);border:1px solid var(--bd);border-radius:10px;padding:14px">'+
      '<div class="mono" style="font-size:9px;letter-spacing:1px;color:var(--tm);margin-bottom:8px">'+k.l+'</div>'+
      '<div style="font-size:22px;font-weight:700;color:'+k.c+'">'+k.v+'</div>'+
      '<div style="font-size:10px;color:var(--td);margin-top:4px">'+k.sub+'</div></div>';
  });
  html+='</div>';

  // Per-replica GPU breakdown
  html+='<div style="font-size:13px;font-weight:600;margin-bottom:12px">\uD83D\uDCBB Replica GPU Status</div>';
  if(gpus.length>0){
    html+='<div class="replica-grid">';
    gpus.forEach(function(g,ri){
      html+='<div class="replica-card">'+
        '<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">'+
          '<span style="font-weight:600;font-size:14px">Replica '+(ri+1)+'</span>'+
          '<span class="dot '+dotClass(g.st)+'" style="margin-left:4px"></span>'+
        '</div>'+
        '<div class="replica-row"><span class="label">Node</span><span class="value">'+g.id+'</span></div>'+
        '<div class="replica-row"><span class="label">GPU</span><span class="value">'+g.type+'</span></div>'+
        '<div class="replica-row"><span class="label">Utilization</span><span class="value" style="color:'+barColor(g.util)+'">'+g.util+'%</span></div>'+
        '<div class="gpu-bar-bg" style="margin-bottom:8px"><div class="gpu-bar-fill" style="width:'+g.util+'%;background:'+barColor(g.util)+'"></div></div>'+
        '<div class="replica-row"><span class="label">VRAM</span><span class="value">'+g.vram+'</span></div>'+
        '<div class="replica-row"><span class="label">Temperature</span><span class="value">'+g.temp+'\u00B0C</span></div>'+
        '<div class="replica-row"><span class="label">Power</span><span class="value">'+g.pw+'</span></div>'+
      '</div>';
    });
    html+='</div>';
  } else {
    html+='<div style="color:var(--tm);font-size:12px;margin-bottom:20px">No active GPUs assigned to this endpoint</div>';
  }

  // Autoscaling config
  html+='<div style="font-size:13px;font-weight:600;margin:20px 0 12px">‚öô\uFE0F Autoscaling Configuration</div>';
  html+='<div style="background:var(--sf2);border:1px solid var(--bd);border-radius:10px;padding:16px;display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:12px">';
  [{l:'Policy',v:autoScale.policy},{l:'Min Replicas',v:autoScale.min},{l:'Max Replicas',v:autoScale.max},{l:'Scale Target',v:autoScale.target},{l:'Cooldown',v:autoScale.cooldown}].forEach(function(c){
    html+='<div><div class="mono" style="font-size:9px;letter-spacing:1px;color:var(--tm);margin-bottom:4px">'+c.l+'</div><div style="font-size:13px;font-weight:500">'+c.v+'</div></div>';
  });
  html+='</div>';

  // Mini trend charts
  html+='<div class="detail-charts">';
  html+='<div class="chart-card"><div style="font-size:13px;font-weight:500;margin-bottom:12px">TTFT Trend</div><svg class="chart" id="detail-ttft" viewBox="0 0 400 140"></svg></div>';
  html+='<div class="chart-card"><div style="font-size:13px;font-weight:500;margin-bottom:12px">Throughput Trend (t/s)</div><svg class="chart" id="detail-tps" viewBox="0 0 400 140"></svg></div>';
  html+='</div>';

  dp.innerHTML=html;

  // Render mini charts
  var ttftBase=parseInt(m.ttft);
  var tpsBase=parseInt(m.tps);
  var ttftData=genData(48,ttftBase,ttftBase*0.3);
  var tpsData=genData(48,tpsBase,tpsBase*0.2);
  makeArea("detail-ttft",ttftData,400,140,"#10b981","detTtftF",undefined,undefined,"ms");
  makeArea("detail-tps",tpsData,400,140,"#8b5cf6","detTpsF",undefined,undefined,"t/s");
}

function hideModelDetail(){
  document.getElementById('model-detail').style.display='none';
  document.getElementById('model-cards').style.display='';
  // shown via bench-section
  document.getElementById('bench-section').style.display='';
}

// Wire up detail buttons
document.querySelectorAll('.detail-btn').forEach(function(btn){
  btn.addEventListener('click',function(){
    showModelDetail(parseInt(btn.dataset.idx));
  });
});

// Time range (visual only)
document.querySelectorAll('.time-btn').forEach(function(btn){
  btn.addEventListener('click',function(){
    document.querySelectorAll('.time-btn').forEach(function(b){b.classList.remove('active')});
    btn.classList.add('active');
  });
});

// Auto-refresh tick
setInterval(function(){
  rpsData.shift();rpsData.push(2400+(Math.random()-.5)*800);
  makeArea("chart-rps",rpsData,800,180,"#3b82f6","rpsF",undefined,undefined,"rps");
},5000);
</script>
</body>
</html>
